\begin{lstlisting}[caption=Causal broadcast, mathescape, captionpos=b]
upon event <Init> do
    deliverd := $\empty$
    past := nil

upon event <rcoBroadcast | m> do
    trigger <rbBroadcast | (DATA, past, m)>
    past := append(past, <$p_i$, m>)

upon event <rbDeliver | $p_i$, (DATA, past$_m$, m)> do
    if m $\notin$ delivered then
        forall ($s_n$, n) $\in$ past$_m$ do
            if n $\notin$ delivered then
                trigger <rcoDeliver | $s_n$, n>
                delivered += {n}
                past := append(past, <$s_n$, n>)

        trigger <rcoDeliver | $p_i$, m>
        delivered += {m}
        past := append(past, <$p_i$, m>)
\end{lstlisting}
