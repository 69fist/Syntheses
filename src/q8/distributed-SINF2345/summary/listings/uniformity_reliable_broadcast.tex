\begin{lstlisting}[mathescape, caption= Uniformity reliable broadcast, captionpos=b]
upon event <urbBroadcast | m> do
    pending += {(self, m)}
    trigger <bebBroadcast | (DATA, self, m)>

upon event <bebDeliver | $p_i$, (DATA, $s_m$, m)> do
    ack[m] += {$p_i$}
    if ($s_m$, m) $\notin$ pending then
        pending += {($s_m$, m)}
        trigger <bebBroadcast | (DATA, $s_m$, m)>

upon exist ($s_m$, m) $\in$ pending s.t canDeliverd(m) AND m $\notin$ delivered do
    delivered += {m}
    trigger <urbDeliver | $s_m$, m>
\end{lstlisting}
